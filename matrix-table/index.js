let datas = [
    {
        "PositionID": "ACCA",
        "PositionName": "Kế toán trưởng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "add1",
        "CompetenceName": "add1",
        "CategoryName": "Cốt lõi",
        "DepartmentID": "AC",
        "CategoryID": "CL",
        "Category": 3,
        "Department": 8,
        "Code": 10704,
        "Framework": 10099,
        "Competence": 13,
        "Position": 9,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-03T14:10:04.377",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "ACSA",
        "PositionName": "Kế toán cửa hàng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "add1",
        "CompetenceName": "add1",
        "CategoryName": "Cốt lõi",
        "DepartmentID": "AC",
        "CategoryID": "CL",
        "Category": 3,
        "Department": 8,
        "Code": 10702,
        "Framework": 10099,
        "Competence": 13,
        "Position": 39,
        "CompetenceLevel": 3,
        "CompetenceLevelMax": 5,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-03T10:13:47.517",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDGD",
        "PositionName": "Giám đốc",
        "DepartmentName": "Ban Giám đốc",
        "CompetenceID": "add1",
        "CompetenceName": "add1",
        "CategoryName": "Cốt lõi",
        "DepartmentID": "BD",
        "CategoryID": "CL",
        "Category": 3,
        "Department": 2,
        "Code": 10722,
        "Framework": 10099,
        "Competence": 13,
        "Position": 1,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:46.537",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDVM",
        "PositionName": "Phó giám đốc phụ trách MD và Supply Chain",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "add1",
        "CompetenceName": "add1",
        "CategoryName": "Cốt lõi",
        "DepartmentID": "BOM",
        "CategoryID": "CL",
        "Category": 3,
        "Department": 1,
        "Code": 10708,
        "Framework": 10099,
        "Competence": 13,
        "Position": 10,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-03T14:10:11.707",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "LGWE",
        "PositionName": "Nhân viên kho",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "add1",
        "CompetenceName": "add1",
        "CategoryName": "Cốt lõi",
        "DepartmentID": "BOM",
        "CategoryID": "CL",
        "Category": 3,
        "Department": 1,
        "Code": 10706,
        "Framework": 10099,
        "Competence": 13,
        "Position": 53,
        "CompetenceLevel": 5,
        "CompetenceLevelMax": 5,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-03T14:10:09.237",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "CXMA",
        "PositionName": "Trưởng phòng CX",
        "DepartmentName": "CX",
        "CompetenceID": "add1",
        "CompetenceName": "add1",
        "CategoryName": "Cốt lõi",
        "DepartmentID": "CX",
        "CategoryID": "CL",
        "Category": 3,
        "Department": 5,
        "Code": 10727,
        "Framework": 10099,
        "Competence": 13,
        "Position": 6,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:52.863",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "ACCA",
        "PositionName": "Kế toán trưởng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "add2",
        "CompetenceName": "add2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "AC",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 8,
        "Code": 10711,
        "Framework": 10099,
        "Competence": 14,
        "Position": 9,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:24.863",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "ACSA",
        "PositionName": "Kế toán cửa hàng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "add2",
        "CompetenceName": "add2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "AC",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 8,
        "Code": 10710,
        "Framework": 10099,
        "Competence": 14,
        "Position": 39,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:24.863",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDGD",
        "PositionName": "Giám đốc",
        "DepartmentName": "Ban Giám đốc",
        "CompetenceID": "add2",
        "CompetenceName": "add2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "BD",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 2,
        "Code": 10724,
        "Framework": 10099,
        "Competence": 14,
        "Position": 1,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:46.537",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDVM",
        "PositionName": "Phó giám đốc phụ trách MD và Supply Chain",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "add2",
        "CompetenceName": "add2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "BOM",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 1,
        "Code": 10713,
        "Framework": 10099,
        "Competence": 14,
        "Position": 10,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:24.863",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "LGWE",
        "PositionName": "Nhân viên kho",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "add2",
        "CompetenceName": "add2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "BOM",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 1,
        "Code": 10712,
        "Framework": 10099,
        "Competence": 14,
        "Position": 53,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:24.863",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "CXMA",
        "PositionName": "Trưởng phòng CX",
        "DepartmentName": "CX",
        "CompetenceID": "add2",
        "CompetenceName": "add2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "CX",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 5,
        "Code": 10729,
        "Framework": 10099,
        "Competence": 14,
        "Position": 6,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:52.863",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "ACCA",
        "PositionName": "Kế toán trưởng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "Mô tả 1test2",
        "CompetenceName": "Mô tả 1test2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "AC",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 8,
        "Code": 10705,
        "Framework": 10099,
        "Competence": 6,
        "Position": 9,
        "CompetenceLevel": 1,
        "CompetenceLevelMax": 1,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-03T14:10:04.377",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "ACSA",
        "PositionName": "Kế toán cửa hàng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "Mô tả 1test2",
        "CompetenceName": "Mô tả 1test2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "AC",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 8,
        "Code": 10703,
        "Framework": 10099,
        "Competence": 6,
        "Position": 39,
        "CompetenceLevel": 3,
        "CompetenceLevelMax": 3,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-03T11:53:53.893",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDGD",
        "PositionName": "Giám đốc",
        "DepartmentName": "Ban Giám đốc",
        "CompetenceID": "Mô tả 1test2",
        "CompetenceName": "Mô tả 1test2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "BD",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 2,
        "Code": 10723,
        "Framework": 10099,
        "Competence": 6,
        "Position": 1,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:46.537",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDVM",
        "PositionName": "Phó giám đốc phụ trách MD và Supply Chain",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "Mô tả 1test2",
        "CompetenceName": "Mô tả 1test2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "BOM",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 1,
        "Code": 10709,
        "Framework": 10099,
        "Competence": 6,
        "Position": 10,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-03T14:10:11.707",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "LGWE",
        "PositionName": "Nhân viên kho",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "Mô tả 1test2",
        "CompetenceName": "Mô tả 1test2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "BOM",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 1,
        "Code": 10707,
        "Framework": 10099,
        "Competence": 6,
        "Position": 53,
        "CompetenceLevel": 5,
        "CompetenceLevelMax": 5,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-03T14:10:09.237",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "CXMA",
        "PositionName": "Trưởng phòng CX",
        "DepartmentName": "CX",
        "CompetenceID": "Mô tả 1test2",
        "CompetenceName": "Mô tả 1test2",
        "CategoryName": "Năng lực bổ trợ",
        "DepartmentID": "CX",
        "CategoryID": "BT",
        "Category": 4,
        "Department": 5,
        "Code": 10728,
        "Framework": 10099,
        "Competence": 6,
        "Position": 6,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:52.863",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "ACCA",
        "PositionName": "Kế toán trưởng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "test4",
        "CompetenceName": "năng lực 4",
        "CategoryName": "Năng lực marketing",
        "DepartmentID": "AC",
        "CategoryID": "MA",
        "Category": 5,
        "Department": 8,
        "Code": 10715,
        "Framework": 10099,
        "Competence": 12,
        "Position": 9,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:30.85",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "ACSA",
        "PositionName": "Kế toán cửa hàng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "test4",
        "CompetenceName": "năng lực 4",
        "CategoryName": "Năng lực marketing",
        "DepartmentID": "AC",
        "CategoryID": "MA",
        "Category": 5,
        "Department": 8,
        "Code": 10714,
        "Framework": 10099,
        "Competence": 12,
        "Position": 39,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:30.85",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDGD",
        "PositionName": "Giám đốc",
        "DepartmentName": "Ban Giám đốc",
        "CompetenceID": "test4",
        "CompetenceName": "năng lực 4",
        "CategoryName": "Năng lực marketing",
        "DepartmentID": "BD",
        "CategoryID": "MA",
        "Category": 5,
        "Department": 2,
        "Code": 10725,
        "Framework": 10099,
        "Competence": 12,
        "Position": 1,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:46.537",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDVM",
        "PositionName": "Phó giám đốc phụ trách MD và Supply Chain",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "test4",
        "CompetenceName": "năng lực 4",
        "CategoryName": "Năng lực marketing",
        "DepartmentID": "BOM",
        "CategoryID": "MA",
        "Category": 5,
        "Department": 1,
        "Code": 10717,
        "Framework": 10099,
        "Competence": 12,
        "Position": 10,
        "CompetenceLevel": 4,
        "CompetenceLevelMax": 5,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:30.85",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "LGWE",
        "PositionName": "Nhân viên kho",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "test4",
        "CompetenceName": "năng lực 4",
        "CategoryName": "Năng lực marketing",
        "DepartmentID": "BOM",
        "CategoryID": "MA",
        "Category": 5,
        "Department": 1,
        "Code": 10716,
        "Framework": 10099,
        "Competence": 12,
        "Position": 53,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:30.85",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "CXMA",
        "PositionName": "Trưởng phòng CX",
        "DepartmentName": "CX",
        "CompetenceID": "test4",
        "CompetenceName": "năng lực 4",
        "CategoryName": "Năng lực marketing",
        "DepartmentID": "CX",
        "CategoryID": "MA",
        "Category": 5,
        "Department": 5,
        "Code": 10730,
        "Framework": 10099,
        "Competence": 12,
        "Position": 6,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:52.863",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "ACCA",
        "PositionName": "Kế toán trưởng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "t18/86",
        "CompetenceName": "test thêm 181/8 asd asd asd qwe qwe",
        "CategoryName": "tên phân nhóm QL asd1",
        "DepartmentID": "AC",
        "CategoryID": "t18/8",
        "Category": 10004,
        "Department": 8,
        "Code": 10719,
        "Framework": 10099,
        "Competence": 10025,
        "Position": 9,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:36.757",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "ACSA",
        "PositionName": "Kế toán cửa hàng",
        "DepartmentName": "Kế toán",
        "CompetenceID": "t18/86",
        "CompetenceName": "test thêm 181/8 asd asd asd qwe qwe",
        "CategoryName": "tên phân nhóm QL asd1",
        "DepartmentID": "AC",
        "CategoryID": "t18/8",
        "Category": 10004,
        "Department": 8,
        "Code": 10718,
        "Framework": 10099,
        "Competence": 10025,
        "Position": 39,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:36.757",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDGD",
        "PositionName": "Giám đốc",
        "DepartmentName": "Ban Giám đốc",
        "CompetenceID": "t18/86",
        "CompetenceName": "test thêm 181/8 asd asd asd qwe qwe",
        "CategoryName": "tên phân nhóm QL asd1",
        "DepartmentID": "BD",
        "CategoryID": "t18/8",
        "Category": 10004,
        "Department": 2,
        "Code": 10726,
        "Framework": 10099,
        "Competence": 10025,
        "Position": 1,
        "CompetenceLevel": 5,
        "CompetenceLevelMax": 5,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:46.537",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "BDVM",
        "PositionName": "Phó giám đốc phụ trách MD và Supply Chain",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "t18/86",
        "CompetenceName": "test thêm 181/8 asd asd asd qwe qwe",
        "CategoryName": "tên phân nhóm QL asd1",
        "DepartmentID": "BOM",
        "CategoryID": "t18/8",
        "Category": 10004,
        "Department": 1,
        "Code": 10721,
        "Framework": 10099,
        "Competence": 10025,
        "Position": 10,
        "CompetenceLevel": 3,
        "CompetenceLevelMax": 5,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:36.757",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "LGWE",
        "PositionName": "Nhân viên kho",
        "DepartmentName": "Hội đồng thành viên",
        "CompetenceID": "t18/86",
        "CompetenceName": "test thêm 181/8 asd asd asd qwe qwe",
        "CategoryName": "tên phân nhóm QL asd1",
        "DepartmentID": "BOM",
        "CategoryID": "t18/8",
        "Category": 10004,
        "Department": 1,
        "Code": 10720,
        "Framework": 10099,
        "Competence": 10025,
        "Position": 53,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:36.757",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    },
    {
        "PositionID": "CXMA",
        "PositionName": "Trưởng phòng CX",
        "DepartmentName": "CX",
        "CompetenceID": "t18/86",
        "CompetenceName": "test thêm 181/8 asd asd asd qwe qwe",
        "CategoryName": "tên phân nhóm QL asd1",
        "DepartmentID": "CX",
        "CategoryID": "t18/8",
        "Category": 10004,
        "Department": 5,
        "Code": 10731,
        "Framework": 10099,
        "Competence": 10025,
        "Position": 6,
        "CompetenceLevel": null,
        "CompetenceLevelMax": null,
        "CreateBy": "Nguyễn Văn Hachi",
        "CreateTime": "2024-04-05T09:11:52.863",
        "LastModifiedBy": null,
        "LastModifiedTime": null
    }
]
let mapCompetence = new Map();
let mapPosition = new Map();

const htmlHeaderTop = `<th class="vertical-cell border-none"></th>
<th class="table-label"></th>
<th></th>`
const htmlHeaderBottom = `<th class="vertical-cell border-none"></th>
<th>
    <div class="table-label">
        <div class="label-top">Năng lực</div>
        <div class="border-label"></div>
        <div class="label-bottom">Vị trí</div>
    </div>
</th>
<th class="add-action">
    <i class="fa-solid fa-circle-plus"></i>
    <span style="display: inline-block;">Thêm năng lực</span>
</th>`
const htmlTbody = ` <tr>
<td class="vertical-cell border-none"></td>
<td class="add-action">
    <i class="fa-solid fa-circle-plus"></i>
    <span style="display: inline-block;">Thêm chức danh</span>
</td>
<td class="cell-none"></td>
</tr>`

const loadData = () => {
    mapCompetence.clear();
    mapPosition.clear();
    datas.forEach(data => {
        if (mapCompetence.has(data["CategoryName"])) {
            let arrTemp = mapCompetence.get(data["CategoryName"])
            if (arrTemp.findIndex(c => c == data["CompetenceName"]) == -1) {
                arrTemp.push(data["CompetenceName"])
            }
            mapCompetence.set(data["CategoryName"], arrTemp)
        } else {
            let arrTemp = []
            arrTemp.push(data["CompetenceName"])
            mapCompetence.set(data["CategoryName"], arrTemp)
        }

        if (mapPosition.has(data["DepartmentName"])) {
            let arrTemp = mapPosition.get(data["DepartmentName"])
            if (arrTemp.findIndex(c => c == data["PositionName"]) == -1) {
                arrTemp.push(data["PositionName"])
            }
            mapPosition.set(data["DepartmentName"], arrTemp)
        } else {
            let arrTemp = []
            arrTemp.push(data["PositionName"])
            mapPosition.set(data["DepartmentName"], arrTemp)
        }
    })
}

const renderCompetenceHeader = () => {
    let htmlCategory = ``
    let htmlCompetence = ``
    mapCompetence.forEach((value, key) => {
        let competenceArr = value
        let colspan = competenceArr.length
        htmlCategory += ` <th class="category-name" colspan="${colspan}">${key}</th>`
        competenceArr.forEach(competence => {
            let htmlTemp = ``
            if (competence == competenceArr[0]) {
                htmlTemp = `<th class="competence-wrap" style="border-left: 1px solid #008000;">`
            }
            if (competence == competenceArr[colspan - 1]) {
                htmlTemp = `<th class="competence-wrap" style="border-right: 1px solid #008000;">`
            }
            if (competence == competenceArr[0] && competence == competenceArr[colspan - 1]) {
                htmlTemp = `<th class="competence-wrap" style="border-right: 1px solid #008000;border-left: 1px solid #008000;">`
            }
            htmlCompetence += htmlTemp + `            
            <div class="competence-item">
            <div class="competence-item--top" title="${competence}"><p>${competence}</p></div>
            <div class="competence-item--bottom"><span>Min</span><span>Max</span></div>
        </div></th>
        `
        })
    })
    const headerTop = document.querySelector(".header-top")
    const headrBottom = document.querySelector(".header-bottom")
    headerTop.innerHTML = htmlHeaderTop + htmlCategory
    headrBottom.innerHTML = htmlHeaderBottom + htmlCompetence
}
const renderPositionSidebar = () => {
    let htmlPosition = ``
    let competenceArr = []
    mapCompetence.forEach((value, key) => {
        competenceArr = competenceArr.concat(value)
    })
    mapPosition.forEach((value, key) => {
        let positionArr = value
        let rowspan = positionArr.length + 1
        let htmlTemp = ``
        htmlTemp += `
        <tr class="department">
                    <th class="vertical-cell" rowspan="${rowspan}">${key}</th>
                </tr>
        `

        positionArr.forEach(p => {
            let obj = datas.find(d => d["PositionName"] == p)
            htmlTemp += `<tr data-position-name = "${p}" class="position-name"  title="${obj.PositionID} | ${p}" >
            <td><div><span class="position-id">${obj.PositionID}</span><span class="border-position"></span><span>${p}</span></div></td>
            <td class="cell-none"></td>
            
        `

            competenceArr.forEach((competence) => {
                htmlTemp += `<td data-competence-name="${competence}" data-position-name="${p}" class="data"><div><input type="number" class="cell min-value" disabled>
            <input type="number" class="cell max-value" disabled></div>
            </td>`
            })
        })
        htmlPosition += htmlTemp + `</tr>`
    })
    const tbody = document.querySelector(".matrix-table tbody")
    tbody.innerHTML = htmlTbody + htmlPosition
}
const renderDataTable = () => {
    loadData()
    renderPositionSidebar()
    renderCompetenceHeader()
    datas.forEach(data => {
        let inputs = document.querySelectorAll(".matrix-table .data")

        inputs.forEach(input => {
            if (input.dataset.competenceName == data["CompetenceName"] && input.dataset.positionName == data["PositionName"]) {
                input.innerHTML = `<div data-code="${data["Code"]}"><input type="number" class="cell min-value" value="${data["CompetenceLevel"]}" onblur=(updateMinMax(${data["Code"]}))>
                <input type="number" class="cell max-value" value="${data["CompetenceLevelMax"]}" onblur=(updateMinMax(${data["Code"]}))></div>`
            }
        })
    })
}
renderDataTable()
const updateMinMax = (code) => {

    //take data to update
    code = Number(code)
    let updateData = {}
    let min, max = 0;
    let dataTd = document.querySelectorAll(".data")
    dataTd.forEach(td => {
        if (Number(td.querySelector("div").dataset.code) == code) {
            min = Number(td.querySelector(".min-value").value)
            max = Number(td.querySelector(".max-value").value)
        }
    })
    updateData = {
        code,
        min,
        max
    }
    //update data
    if (!!updateData) {
        if (updateData.min > 5) {
            updateData.min = 5
        }
        if (updateData.max > 5) {
            updateData.max = 5
        }
        datas.map(data => {
            if (Number(data["Code"]) == Number(updateData["code"])) {
                if (Number(data["CompetenceLevel"]) != Number(updateData["min"]) || Number(data["CompetenceLevelMax"]) != Number(updateData["max"])) {
                    let isUpdate = false;
                    let oldMin = data["CompetenceLevel"]
                    let oldMax = data["CompetenceLevelMax"]
                    data["CompetenceLevel"] = Number(updateData["min"]) > 0 && ((Number(updateData["max"]) > 0 && Number(updateData["max"]) >= Number(updateData["min"])) || (Number(updateData["max"]) <= 0)) ? Number(updateData["min"]) : data["CompetenceLevel"]
                    data["CompetenceLevelMax"] = Number(updateData["max"]) > 0 && Number(updateData["max"]) >= Number(updateData["min"]) ? Number(updateData["max"]) : data["CompetenceLevelMax"]
                    if (!data["CompetenceLevelMax"] && data["CompetenceLevel"]) {
                        data["CompetenceLevelMax"] = data["CompetenceLevel"]
                    }
                    if (data["CompetenceLevelMax"] && !data["CompetenceLevel"]) {
                        data["CompetenceLevel"] = data["CompetenceLevelMax"]
                    }
                    if (oldMin !== data["CompetenceLevel"] || oldMax !== data["CompetenceLevelMax"]) {
                        isUpdate = true
                    }
                    if (isUpdate) {
                        updateData = data
                        showToast("Cập nhật khung năng lực thành công\n\n" + `Tên chức danh: ${updateData["PositionName"]}, Tên năng lực: ${updateData["CompetenceName"]}`, "toasts-success");
                    }

                }
            }
        })
    }
    renderDataTable()
}




function showToast(message, isSuccess, callback) {
    var toastClass = isSuccess ? 'toasts-success' : 'toasts-fail';
    var toastElement = document.createElement('div');
    toastElement.classList.add('toasts', toastClass);
    toastElement.innerHTML = '<div><i class="fa-regular fa-circle-' + (isSuccess ? 'check' : 'xmark') + ' pe-2"></i>' +
        '<p class="toasts-text">' + message + '</p></div>';
    toastElement.classList.add("d-flex", "justify-content-start", "align-items-center")
    document.body.appendChild(toastElement);

    setTimeout(function () {
        toastElement.classList.add('show');
    }, 100);

    setTimeout(function () {
        toastElement.remove();
        if (typeof callback === 'function') {
            callback();
        }
    }, 3000);
}
